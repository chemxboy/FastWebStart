/*///////////////////////////////////////////////////////////////////////////////////////////////////////
///// Code mixing by Molokoloco ..... 2010 ......... [EVER IN PROGRESS (it's not done yet)]  ///////////
////  SOURCES here : https://github.com/molokoloco/FastWebStart/                            ///////////
////  My WIKI here : http://code.google.com/p/molokoloco-coding-project/wiki/WikiMenu      /////////// 
////////////////////////////////////////////////////////////////////////////////////////////////// */
var $E=$E||{}; $(function(){var b,e,f,g,i,k,l=!1,h="edit",c="",m="",r=function(a){k.text(a).addClass("ui-state-highlight");setTimeout(function(){k.removeClass("ui-state-highlight",1500)},500)},q=function(a,p,b,d){return a.val().length>d||a.val().length<b?(a.addClass("ui-state-error"),r("La longueur du "+p+" doit &ecirc;tre entre "+b+" et "+d+" charact&egrave;res."),!1):!0},s=function(a,p,b){return p.test(a.val())?!0:(a.addClass("ui-state-error"),r(b),!1)},t=function(){$("div#divEdit").show();$("div#divEdit").dialog({autoOpen:!1,height:360, minHeight:360,width:420,minWidth:420,modal:!0,close:function(){i.val("").removeClass("ui-state-error")}})},x=function(){$("div#divEdit").length<1?$("body").append('<div id="divEdit" title=""></div>'):$("div#divEdit").dialog("destroy");$("div#divEdit").hide();var a='<form method="post" action="#" name="formEdit" id="formEdit">';a+="<fieldset><legend>Les champs avec <em>*</em> sont obligatoires</legend>";a+='<label for="title" title="Titre du site">Titre de la cat&eacute;gorie<em>*</em> <input type="text" name="title" id="title" value="" class="text ui-widget-content ui-corner-all" maxlength="12"/></label>'; a+="</fieldset></form>";$("div#divEdit").html(a)},y=function(){$("div#divEdit").length<1?$("body").append('<div id="divEdit" title=""></div>'):$("div#divEdit").dialog("destroy");$("div#divEdit").hide();var a='<form method="post" action="#" name="formEdit" id="formEdit">';a+='<fieldset><legend id="legend">Les champs avec <em>*</em> sont obligatoires</legend>';a+='<label for="title" title="Titre du site">Titre du site<em>*</em> <input type="text" name="title" id="title" value="" class="text ui-widget-content ui-corner-all" maxlength="30"/></label>'; a+='<label for="href" title="Lien http:// du site">Lien<em>*</em> <input type="text" name="href" id="href" value="" class="text ui-widget-content ui-corner-all"/></label>';a+='<label for="result" title="Faite une recherche sur le site, regardez l\'url et remplacez votre mot-cl&eacute; par {R}">R&eacute;sultat recherche <input type="text" name="result" id="result" value="" class="text ui-widget-content ui-corner-all"/></label>';a+='<label for="tips" title="En g&eacute;n&eacute;ral, le titre de la page">Description <input type="text" name="tips" id="tips" value="" class="text ui-widget-content ui-corner-all"/></label>'; a+="</fieldset></form>";$("div#divEdit").html(a)},u=function(a){a.preventDefault();m=$(a.currentTarget);h=m.hasClass("addCat")?"add":"edit";x();b=$("input#title");i=$([]).add(b);k=$("legend#legend");h=="add"?($("div#divEdit").attr({title:"Ajouter une cat&eacute;gorie"}),b.val("")):($("div#divEdit").attr({title:"Edition d'une cat&eacute;gorie"}),b.val(m.text()));a={};$.extend(a,{Annuler:function(){$(this).dialog("close")}});$.extend(a,{Valider:function(){var a=!0;i.removeClass("ui-state-error");if(a= (a=a&&q(b,"Titre",2,25))&&s(b,/^([A-Za-z0-9_\- \u00e9\u00e8\u00eb\u00ea\u00e0\u00f9\u00e7\u00ee\u00f4\u00f6])+$/i,"Categorie name may consist of letters and numbers, underscores or dash"))h!="add"&&m.html(b.val()),$(this).dialog("close"),n(),j()}});t();$("div#divEdit").dialog("option","buttons",a);$("div#divEdit").dialog("option","height",200);$("div#divEdit").dialog("option","minHeight",200);$("div#divEdit").dialog("open")},o=function(a){a.preventDefault();c=$(a.currentTarget);h=c.hasClass("addLink")? "add":"edit";y();b=$("input#title");e=$("input#href");f=$("input#result");g=$("input#tips");i=$([]).add(b).add(e).add(f).add(g);k=$("legend#legend");h=="add"?($("div#divEdit").attr({title:"Ajouter un site"}),e.val("http://"),f.val(""),g.val(""),b.val("")):($("div#divEdit").attr({title:"Edition d'un site"}),e.val(c.attr("href")),f.val(c.attr("rel")),g.val(c.attr("title")),b.val(c.text()));a={};$.extend(a,{Annuler:function(){$(this).dialog("close")}});h!="add"&&$.extend(a,{Supprimer:function(){$(this).dialog("close"); c.parent().remove();n();j()}});$.extend(a,{Valider:function(){var a=!0;i.removeClass("ui-state-error");if(a=(a=(a=a&&q(b,"Titre",2,25))&&q(e,"Lien",12,250))&&s(e,/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i, "Ex. : &quot;http://www.site.com&quot;")){if(h=="add"){a=c.parent().prev();var w='<li class="sortLink"><a href="'+addslashes(input2html(e.val()))+'" rel="'+(f.val()?addslashes(input2html(f.val())):"")+'" title="'+(g.val()?addslashes(input2html(g.val())):"")+'" class="l" style="cursor:move;">'+input2html(b.val())+"</a></li>";$(w).insertAfter(a);$("ul.sortUlLink").sortable("refresh")}else c.attr({href:addslashes(input2html(e.val())),rel:f.val()?addslashes(input2html(f.val())):"",title:g.val()?addslashes(input2html(g.val())): ""}),c.html(input2html(b.val()));$(this).dialog("close");n();j()}}});t();$("div#divEdit").dialog("option","buttons",a);$("div#divEdit").dialog("option","height",360);$("div#divEdit").dialog("option","minHeight",360);$("div#divEdit").dialog("open")},z=function(){var a=[],b={},c=[],d=-1;$("ul.sortUlLink").each(function(){$(this).find("a.l").each(function(){var a=$(this);c[c.length]={href:addslashes(a.attr("href")),result:addslashes(a.attr("rel")),tips:addslashes(a.attr("title")),title:addslashes(a.text())}}); $(this).find("h3").each(function(){b.title=$(this).text();d++});b.data=c;a[d]=b;b={};c=[]});return a};$E.saveSITES=function(){SITES=z();var a="var SITES = [",b;for(b in SITES){a+="{title: '"+SITES[b].title+"', data : [";for(var c in SITES[b].data){var d=SITES[b].data[c];d.href&&d.title&&(a+="{href:'"+d.href+"', result:'"+d.result+"', tips:'"+d.tips+"', title:'"+d.title+"'},")}a=a.substring(0,a.length-1);a+="]},"}a=a.substring(0,a.length-1);a+="];";$.ajax({type:"POST",url:"index.php",cache:!1,data:{action:"update", SITES:a},success:function(a){$E.quitEditByUser();$E.quitEditMode();a=="1"?alert("Sauvegarde r&eacute;ussie"):alert("Vous devez vous connecter (avec Facebook) pour sauvegarder vos modifications")}});return!1};var j=function(){l=!0;$("#infoTexte").hide();$("#Sauvegarder").show();$("#Annuler").show();window.onbeforeunload=function(){if(l)return"Quitter la page sans enregistrer ?";return!0}};$E.quitEditByUser=function(){l=!1;window.onbeforeunload=null;$("#infoTexte").show();$("#Sauvegarder").hide();$("#Annuler").hide()}; var v=function(a){a.preventDefault()},n=function(){$("li h3").bind("dblclick",u);$("li a.l").bind("click",v);$("li a.l").bind("dblclick",o);$("li a.addLink").bind("click",o)};$E.quitEditMode=function(){if(!l||confirm("Quitter la page sans enregistrer ?"))if($E.quitEditByUser(),$("div#divEditInfos").hide(),$("li h3").unbind("dblclick",u),$("li a.l").unbind("click",v),$("li a.l").unbind("dblclick",o),$("li a.addLink").unbind("click",o),$("li.liAddLink").remove(),$("ul.sortUlCat").sortable("destroy"), $("ul.sortUlLink").sortable("destroy"),$("li.sortLinkCat h3").css({cursor:""}),$("a.l").css({cursor:""}),$("ul.sortUlCat").removeClass("borderFocus"),$("ul.sortUlLink").removeClass("borderFocus"),$H.initSites(),document.location.hash=="#editmode")document.location.hash=""};$E.startEditMode=function(){$E.quitEditByUser();$("div#divEditInfos").length==0?$("body").append('<div id="divEditInfos"><h3 style="display:inline;">Mode &eacute;dition :</h3> <span id="infoTexte"><strong>Cliquez</strong> sur les liens ou les cat&eacute;gories pour les d&eacute;placer, <strong>double-cliquez</strong> pour les &eacute;diter</span> <button type="button" id="Sauvegarder" onclick="$E.saveSITES();" title="Enregistrer les liens et le th&egrave;me de cette page (Connexion obligatoire avec Facebook)" style="display:none;">Sauvegarder</button> <button type="button" id="Annuler" onclick="$E.quitEditByUser();$E.quitEditMode();" title="Annuler les modifications" style="display:none;">Annuler</button></div>'): $("div#divEditInfos").show();$("li.liAddLink").length<1&&$("ul.sortUlLink").each(function(){var a=$(this).find("li.sortLink:last");$('<li class="liAddLink"><a href="javascript:void(0);" title="Ajouter un lien dans cette cat&eacute;gorie" class="addLink">[+]</a></li>').insertAfter(a)});$("ul.sortUlCat").addClass("borderFocus");$("ul.sortUlLink").addClass("borderFocus");$("ul.sortUlCat").sortable({handle:"li.sortLinkCat",forcePlaceholderSize:!0,placeholder:"placeHolder",change:j});$("ul.sortUlLink").sortable({connectWith:"ul.sortUlLink", forcePlaceholderSize:!0,placeholder:"placeHolder",items:"li:not(.sortLinkCat, .liAddLink)",change:j}).disableSelection();$("li.sortLinkCat h3").css({cursor:"move"});$("a.l").css({cursor:"move"});$H.setUlColSize(!1);$H.centerElements();n();document.location.hash="editmode"}});