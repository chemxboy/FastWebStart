/*///////////////////////////////////////////////////////////////////////////////////////////////////////
///// Code mixing by Molokoloco ..... 2010 ......... [EVER IN PROGRESS (it's not done yet)]  ///////////
////  SOURCES here : https://github.com/molokoloco/FastWebStart/                            ///////////
////  My WIKI here : http://code.google.com/p/molokoloco-coding-project/wiki/WikiMenu      /////////// 
////////////////////////////////////////////////////////////////////////////////////////////////// */
var $E=$E||{};
(function(a,k){var c,f,g,h,l,m,n=false,i="edit",e="",o="",t=function(b){m.text(b).addClass("ui-state-highlight");setTimeout(function(){m.removeClass("ui-state-highlight",1500)},500)},r=function(b,d,j,u){if(b.val().length>u||b.val().length<j){b.addClass("ui-state-error");t("La longueur du "+d+" doit &ecirc;tre entre "+j+" et "+u+" charact&egrave;res.");return false}else return true},v=function(b,d,j){if(d.test(b.val()))return true;else{b.addClass("ui-state-error");t(j);return false}},w=function(){a("div#divEdit").show();
a("div#divEdit").dialog({autoOpen:false,height:360,minHeight:360,width:420,minWidth:420,modal:true,close:function(){l.val("").removeClass("ui-state-error")}})},z=function(){a("div#divEdit").length<1?a("body").append('<div id="divEdit" title=""></div>'):a("div#divEdit").dialog("destroy");a("div#divEdit").hide();var b='<form method="post" action="#" name="formEdit" id="formEdit">';b+="<fieldset><legend>Les champs avec <em>*</em> sont obligatoires</legend>";b+='<label for="title" title="Titre du site">Titre de la cat&eacute;gorie<em>*</em> <input type="text" name="title" id="title" value="" class="text ui-widget-content ui-corner-all" maxlength="12"/></label>';
b+="</fieldset></form>";a("div#divEdit").html(b)},A=function(){a("div#divEdit").length<1?a("body").append('<div id="divEdit" title=""></div>'):a("div#divEdit").dialog("destroy");a("div#divEdit").hide();var b='<form method="post" action="#" name="formEdit" id="formEdit">';b+='<fieldset><legend id="legend">Les champs avec <em>*</em> sont obligatoires</legend>';b+='<label for="title" title="Titre du site">Titre du site<em>*</em> <input type="text" name="title" id="title" value="" class="text ui-widget-content ui-corner-all" maxlength="30"/></label>';
b+='<label for="href" title="Lien http:// du site">Lien<em>*</em> <input type="text" name="href" id="href" value="" class="text ui-widget-content ui-corner-all"/></label>';b+='<label for="result" title="Faite une recherche sur le site, regardez l\'url et remplacez votre mot-cl&eacute; par {R}">R&eacute;sultat recherche <input type="text" name="result" id="result" value="" class="text ui-widget-content ui-corner-all"/></label>';b+='<label for="tips" title="En g&eacute;n&eacute;ral, le titre de la page">Description <input type="text" name="tips" id="tips" value="" class="text ui-widget-content ui-corner-all"/></label>';
b+="</fieldset></form>";a("div#divEdit").html(b)},x=function(b){b.preventDefault();o=a(b.currentTarget);i=o.hasClass("addCat")?"add":"edit";z();c=a("input#title");l=a([]).add(c);m=a("legend#legend");if(i=="add"){a("div#divEdit").attr({title:"Ajouter une cat&eacute;gorie"});c.val("")}else{a("div#divEdit").attr({title:"Edition d'une cat&eacute;gorie"});c.val(o.text())}b={};a.extend(b,{Annuler:function(){a(this).dialog("close")}});a.extend(b,{Valider:function(){var d=true;l.removeClass("ui-state-error");
if(d=(d=d&&r(c,"Titre",2,25))&&v(c,/^([A-Za-z0-9_\- \u00e9\u00e8\u00eb\u00ea\u00e0\u00f9\u00e7\u00ee\u00f4\u00f6])+$/i,"Categorie name may consist of letters and numbers, underscores or dash")){i!="add"&&o.html(c.val());a(this).dialog("close");s();p()}}});w();a("div#divEdit").dialog("option","buttons",b);a("div#divEdit").dialog("option","height",200);a("div#divEdit").dialog("option","minHeight",200);a("div#divEdit").dialog("open")},q=function(b){b.preventDefault();e=a(b.currentTarget);i=e.hasClass("addLink")?
"add":"edit";A();c=a("input#title");f=a("input#href");g=a("input#result");h=a("input#tips");l=a([]).add(c).add(f).add(g).add(h);m=a("legend#legend");if(i=="add"){a("div#divEdit").attr({title:"Ajouter un site"});f.val("http://");g.val("");h.val("");c.val("")}else{a("div#divEdit").attr({title:"Edition d'un site"});f.val(e.attr("href"));g.val(e.attr("rel"));h.val(e.attr("title"));c.val(e.text())}b={};a.extend(b,{Annuler:function(){a(this).dialog("close")}});i!="add"&&a.extend(b,{Supprimer:function(){a(this).dialog("close");
e.parent().remove()}});a.extend(b,{Valider:function(){var d=true;l.removeClass("ui-state-error");if(d=(d=(d=d&&r(c,"Titre",2,25))&&r(f,"Lien",12,250))&&v(f,/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,
"Ex. : &quot;http://www.site.com&quot;")){if(i=="add"){d=e.parent().prev();var j='<li class="sortLink"><a href="'+addslashes(input2html(f.val()))+'" rel="'+(g.val()?addslashes(input2html(g.val())):"")+'" title="'+(h.val()?addslashes(input2html(h.val())):"")+'" class="l" style="cursor:move;">'+input2html(c.val())+"</a></li>";a(j).insertAfter(d);a("ul.sortUlLink").sortable("refresh")}else{e.attr({href:addslashes(input2html(f.val())),rel:g.val()?addslashes(input2html(g.val())):"",title:h.val()?addslashes(input2html(h.val())):
""});e.html(input2html(c.val()))}a(this).dialog("close");s();p()}}});w();a("div#divEdit").dialog("option","buttons",b);a("div#divEdit").dialog("option","height",360);a("div#divEdit").dialog("option","minHeight",360);a("div#divEdit").dialog("open")},p=function(){n=true;a("#infoTexte").hide();a("#Sauvegarder").show();a("#Annuler").show();window.onbeforeunload=function(){if(n)return"Quitter la page sans enregistrer ?";return true}};k.quitEditByUser=function(){n=false;window.onbeforeunload=null;a("#infoTexte").show();
a("#Sauvegarder").hide();a("#Annuler").hide()};var y=function(b){b.preventDefault()},s=function(){a("li h3").bind("dblclick",x);a("li a.l").bind("click",y);a("li a.l").bind("dblclick",q);a("li a.addLink").bind("click",q)};k.quitEditMode=function(){if(!(n&&!confirm("Quitter la page sans enregistrer ?"))){k.quitEditByUser();a("div#divEditInfos").hide();a("li h3").unbind("dblclick",x);a("li a.l").unbind("click",y);a("li a.l").unbind("dblclick",q);a("li a.addLink").unbind("click",q);a("li.liAddLink").remove();
a("ul.sortUlCat").sortable("destroy");a("ul.sortUlLink").sortable("destroy");a("li.sortLinkCat h3").css({cursor:""});a("a.l").css({cursor:""});a("ul.sortUlCat").removeClass("borderFocus");a("ul.sortUlLink").removeClass("borderFocus");$H.initSites();if(document.location.hash=="#editmode")document.location.hash=""}};k.startEditMode=function(){k.quitEditByUser();a("div#divEditInfos").length==0?a("body").append('<div id="divEditInfos"><h3 style="display:inline;">Mode &eacute;dition : </h3><span id="infoTexte"><strong>Cliquez</strong> sur les liens ou les cat&eacute;gories pour les d&eacute;placer, <strong>double-cliquez</strong> pour les &eacute;diter</span> <button type="button" id="Sauvegarder" onclick="saveSITES();" title="Enregistrer les liens et le th&egrave;me de cette page (Connexion obligatoire avec Facebook)" style="display:none;">Sauvegarder</button> <button type="button" id="Annuler" onclick="$E.quitEditByUser();$E.quitEditMode();" title="Annuler les modifications" style="display:none;">Annuler</button></div>'):
a("div#divEditInfos").show();a("li.liAddLink").length<1&&a("ul.sortUlLink").each(function(){var b=a(this).find("li.sortLink:last");a('<li class="liAddLink"><a href="javascript:void(0);" title="Ajouter un lien dans cette cat&eacute;gorie" class="addLink">[+]</a></li>').insertAfter(b)});a("ul.sortUlCat").addClass("borderFocus");a("ul.sortUlLink").addClass("borderFocus");a("ul.sortUlCat").sortable({handle:"li.sortLinkCat",forcePlaceholderSize:true,placeholder:"placeHolder",change:p});a("ul.sortUlLink").sortable({connectWith:"ul.sortUlLink",
forcePlaceholderSize:true,placeholder:"placeHolder",items:"li:not(.sortLinkCat, .liAddLink)",change:p}).disableSelection();a("li.sortLinkCat h3").css({cursor:"move"});a("a.l").css({cursor:"move"});$H.setUlCol(false);$H.posItem();s();document.location.hash="editmode"}})(jQuery,$E);